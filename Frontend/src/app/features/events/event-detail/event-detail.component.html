<section class="event-detail-page">
  <div class="event-detail-container">

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <svg class="spinner" width="48" height="48" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" opacity="0.25" />
        <path d="M12 2C6.47715 2 2 6.47715 2 12" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
      </svg>
      <p>Loading event...</p>
    </div>

    <!-- Event Content -->
    <div *ngIf="!isLoading && event" class="event-content">

      <!-- Back Button -->
      <div class="back-navigation">
        <a routerLink="/events" class="back-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Back to Events
        </a>
      </div>

      <!-- Event Header -->
      <div class="event-header">
        <div class="header-content">
          <div class="event-badges">
            <span class="event-status" [class]="getEventStatus()">
              {{ getEventStatus() }}
            </span>
            <span *ngIf="!event.isPublic" class="event-badge private">Private</span>
            <span *ngIf="isFull()" class="event-badge full">Full</span>
          </div>

          <h1 class="event-title">{{ event.title }}</h1>

          <!-- Event Meta -->
          <div class="event-meta-header">
            <div class="meta-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M8 7V3M16 7V3M7 11H17M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div>
                <strong>Start:</strong> {{ formatDate(event.startDate) }}
              </div>
            </div>

            <div class="meta-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M8 7V3M16 7V3M7 11H17M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div>
                <strong>End:</strong> {{ formatDate(event.endDate) }}
              </div>
            </div>

            <div class="meta-item" *ngIf="event.location">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div>
                <strong>Location:</strong> {{ event.location }}
              </div>
            </div>

            <div class="meta-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M17 21V19C17 16.7909 15.2091 15 13 15H5C2.79086 15 1 16.7909 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M23 21V19C23 17.1362 21.7252 15.5701 20 15.126" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M16 3.12988C17.7252 3.57393 19 5.13999 19 7.00098C19 8.86196 17.7252 10.428 16 10.872" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div>
                <strong>Participants:</strong> {{ participantCount }}{{ event.capacity && event.capacity > 0 ? '/' + event.capacity : '' }}
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="event-actions">
          <!-- Organizer Actions -->
          <div *ngIf="isOrganizer()" class="organizer-actions">
            <button class="btn btn-edit" (click)="editEvent()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.43741 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              Edit Event
            </button>
            <button class="btn btn-delete" (click)="deleteEvent()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M19 6V20C19 21 18 22 17 22H7C6 22 5 21 5 20V6M8 6V4C8 3 9 2 10 2H14C15 2 16 3 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              Delete
            </button>
          </div>

          <!-- Participant Actions -->
          <div *ngIf="!isOrganizer()" class="participant-actions">
            <button *ngIf="canJoin()"
                    class="btn btn-join"
                    (click)="join()"
                    [disabled]="isLoadingAction">
              {{ isLoadingAction ? 'Joining...' : 'Join Event' }}
            </button>

            <button *ngIf="canLeave()"
                    class="btn btn-leave"
                    (click)="leave()"
                    [disabled]="isLoadingAction">
              {{ isLoadingAction ? 'Leaving...' : 'Leave Event' }}
            </button>

            <div *ngIf="!isLoggedIn" class="login-prompt">
              <p>Please <a routerLink="/login">log in</a> to join this event</p>
            </div>

            <div *ngIf="isFull() && !isParticipant" class="full-message">
              <p>This event is full</p>
            </div>

            <div *ngIf="getEventStatus() === 'past'" class="past-message">
              <p>This event has ended</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Capacity Progress Bar -->
      <div *ngIf="event.capacity && event.capacity > 0" class="capacity-section">
        <div class="capacity-header">
          <span>Event Capacity</span>
          <span class="capacity-text">{{ participantCount }} / {{ event.capacity }} participants</span>
        </div>
        <div class="capacity-bar">
          <div class="capacity-fill" [style.width.%]="getCapacityPercentage()"></div>
        </div>
      </div>

      <!-- Event Description -->
      <div class="event-description-section">
        <h2>About This Event</h2>
        <p *ngIf="event.description" class="event-description">{{ event.description }}</p>
        <p *ngIf="!event.description" class="no-description">No description provided</p>

        <div *ngIf="event?.tags?.length" class="event-tags-section">
          <h2>Event Tags</h2>

          <div class="event-tags-list">
            <span class="tag-item" *ngFor="let tag of event.tags">
              {{ tag.name }}
            </span>
          </div>
        </div>
      </div>

      <!-- Participants Section -->
      <div class="participants-section">
        <h2>Participants ({{ participantCount }})</h2>
        <div *ngIf="participantCount === 0" class="no-participants">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M17 21V19C17 16.7909 15.2091 15 13 15H5C2.79086 15 1 16.7909 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M23 21V19C23 17.1362 21.7252 15.5701 20 15.126" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M16 3.12988C17.7252 3.57393 19 5.13999 19 7.00098C19 8.86196 17.7252 10.428 16 10.872" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <p>No participants yet. Be the first to join!</p>
        </div>

        <div *ngIf="participants.length > 0" class="participants-list">
          <div *ngFor="let user of participants" class="participant-item">
            <div class="participant-info">
              <span class="participant-name">{{ user.firstName }} {{ user.lastName }}</span>
            </div>
          </div>
        </div>

      </div>

    </div>

  </div>
</section>
