<section class="events-page">
  <div class="events-container">

    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>Discover Events</h1>
        <p>Find and join amazing events happening around you</p>
      </div>
      <a *ngIf="isLoggedIn$ | async" routerLink="/events/create" class="btn btn-create">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Create Event
      </a>
    </div>

    <!-- Filters & Search -->
    <div class="controls">
      <!-- Filter Tabs -->
      <div class="filter-tabs">
        <button class="filter-tab"
                [class.active]="activeFilter === 'all'"
                (click)="setFilter('all')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M8 7V3M16 7V3M7 11H17M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          All Events
        </button>

        <button class="filter-tab"
                [class.active]="activeFilter === 'upcoming'"
                (click)="setFilter('upcoming')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Upcoming
        </button>

        <button class="filter-tab"
                [class.active]="activeFilter === 'popular'"
                (click)="setFilter('popular')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Popular
        </button>
      </div>

      <!-- Search & Sort -->
      <div class="controls-right">
        <!-- Search -->
        <div class="search-box">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <input type="text"
                 placeholder="Search events..."
                 [(ngModel)]="searchTitle"
                 (keyup.enter)="onSearch()"
                 class="search-input" />
          <button *ngIf="searchTitle" class="clear-search" (click)="searchTitle = ''; onSearch()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>

        <!-- Sort -->
        <div class="sort-box">
          <label>Sort by:</label>
          <select [(ngModel)]="sortBy" (change)="onSortChange()" class="sort-select">
            <option value="startDate">Start Date</option>
            <option value="createdAt">Recently Added</option>
            <option value="participants">Most Popular</option>
          </select>
          <button class="sort-order" (click)="sortDescending = !sortDescending; onSortChange()" [title]="sortDescending ? 'Descending' : 'Ascending'">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" [class.rotate]="!sortDescending">
              <path d="M3 6H13M3 12H11M3 18H13M17 4V20M17 20L13 16M17 20L21 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <svg class="spinner" width="48" height="48" viewBox="0 0 24 24" fill="none">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" opacity="0.25" />
        <path d="M12 2C6.47715 2 2 6.47715 2 12" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
      </svg>
      <p>Loading events...</p>
    </div>

    <!-- Events Grid -->
    <div *ngIf="!isLoading" class="events-grid">
      <!-- Empty State -->
      <div *ngIf="events.length === 0" class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
          <path d="M8 7V3M16 7V3M7 11H17M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        <h3>No Events Found</h3>
        <p>Try adjusting your filters or search query</p>
        <button class="btn btn-primary" (click)="searchTitle = ''; activeFilter = 'all'; onSearch()">
          Clear Filters
        </button>
      </div>

      <!-- Event Cards -->
      <div *ngFor="let event of events" class="event-card">
        <!-- Status Badge -->
        <div class="event-status" [class]="getEventStatus(event)">
          {{ getEventStatus(event) }}
        </div>

        <!-- Full Badge -->
        <div *ngIf="isFull(event)" class="event-full-badge">
          Full
        </div>

        <!-- Event Content -->
        <div class="event-content">
          <h3 class="event-title">
            <a [routerLink]="['/events', event.id]">{{ event.title }}</a>
          </h3>

          <p class="event-description" *ngIf="event.description">
            {{ event.description.length > 100 ? (event.description.substring(0, 100) + '...') : event.description }}
          </p>

          <div class="event-meta">
            <div class="meta-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M8 7V3M16 7V3M7 11H17M5 21H19C20.1046 21 21 20.1046 21 19V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V19C3 20.1046 3.89543 21 5 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ formatDate(event.startDate) }}
            </div>

            <div class="meta-item" *ngIf="event.location">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ event.location }}
            </div>

            <div class="meta-item">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M17 21V19C17 16.7909 15.2091 15 13 15H5C2.79086 15 1 16.7909 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M23 21V19C23 17.1362 21.7252 15.5701 20 15.126" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M16 3.12988C17.7252 3.57393 19 5.13999 19 7.00098C19 8.86196 17.7252 10.428 16 10.872" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ getParticipantCount(event.id ?? '') }}{{ (event.capacity ?? 0) > 0 ? '/' + event.capacity : '' }}
            </div>
          </div>

          <!-- Capacity Bar -->
          <div *ngIf="(event.capacity ?? 0) > 0" class="capacity-bar">
            <div class="capacity-fill" [style.width.%]="getCapacityPercentage(event)"></div>
          </div>

          <!-- View Button -->
          <a [routerLink]="['/events', event.id]" class="btn btn-view">
            View Details
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && events.length > 0" class="pagination">
      <button class="btn btn-pagination"
              (click)="previousPage()"
              [disabled]="currentPage === 1">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        Previous
      </button>

      <span class="page-info">Page {{ currentPage }}</span>

      <button class="btn btn-pagination"
              (click)="nextPage()"
              [disabled]="events.length < pageSize">
        Next
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </div>

  </div>
</section>
